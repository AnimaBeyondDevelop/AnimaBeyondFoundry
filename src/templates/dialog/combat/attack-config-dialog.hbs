<form class='{{cssClass}} {{#if this.allowed}}allowed{{/if}}' autocomplete='off'>
  {{#> "systems/animabf/templates/common/ui/group-body.hbs" class="attack-config"}}
    {{#if this.allowed}}

      <div class='columns'>
        {{> "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
            title=(localize 'macros.combat.dialog.modifier.title')
            inputName="attacker.combat.modifier"
            inputValue=this.attacker.combat.modifier }}
      </div>

      {{!-- {{#if this.ui.hasFatiguePoints}}
        {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
            title=(localize 'macros.combat.dialog.fatigue.title')
            inputName="attacker.combat.fatigueUsed"
            inputValue=this.attacker.combat.fatigueUsed }}
          <option {{#if (is "eq" 0 this.attacker.combat.fatigueUsed)}}selected{{/if}} value='0'>0</option>
          {{#iterateNumber (minNumber this.attacker.actor.system.characteristics.secondaries.fatigue.value 5)}}
            <option {{#if (is "eq" (math this "+" 1) ../this.attacker.combat.fatigueUsed)}}selected{{/if}} value='{{math this "+" 1}}'>{{math this "+" 1}}</option>
          {{/iterateNumber}}
        {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
      {{else}}
        <p class='label no-fatigue'>{{localize 'macros.combat.dialog.notEnoughFatigue.title'}}</p>
      {{/if}} --}}

      {{#if this.attacker.combat.weapon}}
        {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
            title=(localize 'macros.combat.dialog.weapon.title')
            disabled=true }}
          <option selected>
            {{localize 'macros.combat.dialog.weaponRow.attack.title'
              name=this.attacker.combat.weapon.name
              value=this.attacker.combat.weapon.system.attack.final.value}}
          </option>
        {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}

        <input type="hidden" name="attacker.combat.weaponUsed" value="{{this.attacker.combat.weapon._id}}" />
      {{else}}
        <p class='label'>{{localize 'macros.combat.dialog.weapon.notFound'}}</p>
      {{/if}}

      {{#unless this.attacker.combat.unarmed}}
        {{#if this.ui.weaponHasSecondaryCritic}}
          {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
              title=(localize 'macros.combat.dialog.weapon.critic.title')
              inputName='attacker.combat.criticSelected' }}
            <option {{#if (is "eq" this.attacker.combat.weapon.system.critic.primary.value this.attacker.combat.criticSelected)}}selected{{/if}}
                    value='{{this.attacker.combat.weapon.system.critic.primary.value}}'>
              {{localize (concat 'anima.ui.combat.armors.at.' this.attacker.combat.weapon.system.critic.primary.value '.title')}}
            </option>
            <option {{#if (is "eq" this.attacker.combat.weapon.system.critic.secondary.value this.attacker.combat.criticSelected)}}selected{{/if}}
                    value='{{this.attacker.combat.weapon.system.critic.secondary.value}}'>
              {{localize (concat 'anima.ui.combat.armors.at.' this.attacker.combat.weapon.system.critic.secondary.value '.title')}}
            </option>
          {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
        {{else}}
          {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
              title=(localize 'macros.combat.dialog.weapon.critic.title')
              disabled=true
              inputName='attacker.combat.criticSelected' }}
            <option selected value='{{this.attacker.combat.weapon.system.critic.primary.value}}'>
              {{localize (concat 'anima.ui.combat.armors.at.' this.attacker.combat.weapon.system.critic.primary.value '.title')}}
            </option>
          {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
        {{/if}}
      {{/unless}}

      {{> "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
          title=(localize 'macros.combat.dialog.damage.title')
          inputName="attacker.combat.damage.special"
          inputValue=this.attacker.combat.damage.special
          hasSecondaryInput=true
          disableSecondaryInput=true
          secondaryInputName="attacker.combat.damage.final"
          secondaryInputValue=this.attacker.combat.damage.final }}

      {{!-- {{#if this.attacker.combat.projectile.value}}
        <div class='columns'>
          {{> "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
              title=(localize 'macros.combat.dialog.highGround.title')
              inputType="checkbox"
              inputName="attacker.highGround"
              inputValue=(is 'eq' this.attacker.highGround true) }}
        </div>
        <div class='columns'>
          {{> "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
              title=(localize 'macros.combat.dialog.poorVisibility.title')
              inputType="checkbox"
              inputName="attacker.poorVisibility"
              inputValue=(is 'eq' this.attacker.poorVisibility true) }}
        </div>
        <div class='columns'>
          {{> "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
              title=(localize 'macros.combat.dialog.targetInCover.title')
              inputType="checkbox"
              inputName="attacker.targetInCover"
              inputValue=(is 'eq' this.attacker.targetInCover true) }}
        </div>
      {{/if}} --}}

      {{#if this.attackSent}}
        <div class='attack-sent'>
          {{>'systems/animabf/templates/common/ui/loading-indicator.hbs' class="big"}}
          <p class='label'>{{localize 'macros.combat.dialog.attackSent.title'}}</p>
        </div>
      {{else}}
        <button class='animabf-button send-attack'>
          {{localize 'macros.combat.dialog.attackButton.title'}}
        </button>
      {{/if}}

    {{else}}
      <div class='waiting-row'>
        {{>'systems/animabf/templates/common/ui/loading-indicator.hbs' class="big"}}
        <p class='label'>{{localize 'macros.combat.dialog.waitRequest.title'}}</p>
      </div>
    {{/if}}
  {{/"systems/animabf/templates/common/ui/group-body.hbs"}}
</form>
