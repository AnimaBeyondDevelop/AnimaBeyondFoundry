{{>
"systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
  title=(localize 'macros.combat.dialog.modifier.title')
  disabled=this.attackSent
  inputName="attacker.combat.modifier"
  inputValue=this.attacker.combat.modifier
}}
{{#if this.ui.hasFatiguePoints}}
  {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
    title=(localize 'macros.combat.dialog.fatigue.title')
    disabled=this.attackSent
    inputName="attacker.combat.fatigueUsed"
    inputValue=this.attacker.combat.fatigueUsed
  }}
    <option {{#if (is "eq" 0 this.attacker.combat.fatigueUsed)}}selected{{/if}} value='0'>0</option>

    {{#iterateNumber (minNumber this.attacker.actor.system.characteristics.secondaries.fatigue.value 5)}}
      <option {{#if (is "eq" (math this "+" 1) ../this.attacker.combat.fatigueUsed)}}selected{{/if}} value='{{math this "+" 1}}'>{{math this "+" 1}}</option>
    {{/iterateNumber}}
  {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
{{else}}
  <p class='label no-fatigue'>{{localize 'macros.combat.dialog.notEnoughFatigue.title'}}</p>
{{/if}}

{{#if this.attacker.combat.unarmed}}
  {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
    title=(localize 'macros.combat.dialog.weapon.title')
    disabled=true
  }}
    <option>Unarmed</option>
  {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
{{else}}
  {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
    title=(localize 'macros.combat.dialog.weapon.title')
    disabled=this.attackSent
    inputName='attacker.combat.weaponUsed'
  }}
    {{#each this.attacker.actor.system.combat.weapons}}
      <option {{#if (is "eq" this._id ../this.attacker.combat.weaponUsed)}}selected{{/if}} value='{{this._id}}'>{{localize 'macros.combat.dialog.weaponRow.attack.title' name=this.name value=this.system.attack.final.value}}</option>
    {{/each}}
  {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
{{/if}}

{{#unless this.attacker.combat.unarmed}}
  {{#if this.ui.weaponHasSecondaryCritic}}
    {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
      title=(localize 'macros.combat.dialog.weapon.critic.title')
      disabled=this.attackSent
      inputName='attacker.combat.criticSelected'
    }}
      <option {{#if (is "eq" this.attacker.combat.weapon.system.critic.primary.value this.attacker.combat.criticSelected)}}selected{{/if}} value='{{this.attacker.combat.weapon.system.critic.primary.value}}'>{{localize (concat 'anima.ui.combat.armors.at.' this.attacker.combat.weapon.system.critic.primary.value '.title')}}</option>
      <option {{#if (is "eq" this.attacker.combat.weapon.system.critic.secondary.value this.attacker.combat.criticSelected)}}selected{{/if}} value='{{this.attacker.combat.weapon.system.critic.secondary.value}}'>{{localize (concat 'anima.ui.combat.armors.at.' this.attacker.combat.weapon.system.critic.secondary.value '.title')}}</option>
    {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
  {{else}}
    {{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
      title=(localize 'macros.combat.dialog.weapon.critic.title')
      disabled=true
      inputName='attacker.combat.criticSelected'
    }}
      <option selected value='{{this.attacker.combat.weapon.system.critic.primary.value}}'>{{localize (concat 'anima.ui.combat.armors.at.' this.attacker.combat.weapon.system.critic.primary.value '.title')}}</option>
    {{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
  {{/if}}
{{/unless}}

{{>
"systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
  title=(localize 'macros.combat.dialog.damage.title')
  inputName="attacker.combat.damage.special"
  inputValue=this.attacker.combat.damage.special
  disabled=this.attackSent
  hasSecondaryInput=true
  disableSecondaryInput=true
  secondaryInputName="attacker.combat.damage.final"
  secondaryInputValue=this.attacker.combat.damage.final
}}

{{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
  title=(localize 'macros.combat.dialog.specialPorpuseAttack.title')
  disabled=this.attackSent
  inputName='attacker.combat.specialPorpuseAttack.value'
}}
  {{#each this.attacker.specialPorpuseAttacks}}
    <option {{#if (is "eq" ../this.attacker.combat.specialPorpuseAttack.value this)}}selected{{/if}} value='{{this}}'>{{localize (concat 'macros.combat.dialog.specialPorpuseAttack.' this '.title')}}</option>
  {{/each}}
{{/'systems/animabf/templates/common/ui/custom-select.hbs'}}

{{#if (is 'eq' this.attacker.combat.specialPorpuseAttack.value 'directed')}}
{{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
  title=(localize 'macros.combat.dialog.directedAttack.title')
  disabled=this.attackSent
  inputName='attacker.combat.specialPorpuseAttack.directed'
}}
  <option {{#if (is "eq" ../this.attacker.combat.specialPorpuseAttack.directed 'none')}}selected{{/if}} value='none'>{{localize (concat 'macros.combat.dialog.directedAttack.none.title')}}</option>
  {{#each this.attacker.directedAttacks}}
    <option {{#if (is "eq" ../this.attacker.combat.specialPorpuseAttack.directed @key)}}selected{{/if}} value='{{@key}}'>{{localize (concat 'macros.combat.dialog.directedAttack.' @key '.title')}}</option>
  {{/each}}
{{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
{{/if}}

{{#if (is 'eq' this.attacker.combat.specialPorpuseAttack.value 'disable')}}
{{#> 'systems/animabf/templates/common/ui/custom-select.hbs'
  title=(localize 'macros.combat.dialog.directedAttack.title')
  disabled=this.attackSent
  inputName='attacker.combat.specialPorpuseAttack.directed'
}}
  <option {{#if (is "eq" this.attacker.combat.specialPorpuseAttack.directed 'none')}}selected{{/if}} value='none'>{{localize (concat 'macros.combat.dialog.directedAttack.none.title')}}</option>
  {{#each this.attacker.directedAttacks}}
    {{#if (or (is 'eq' @key 'elbow') (is 'eq' @key 'foot') (is 'eq' @key 'hand') (is 'eq' @key 'knee') (is 'eq' @key 'arm') (is 'eq' @key 'thigh') (is 'eq' @key 'calf') (is 'eq' @key 'wrist'))}}
      <option {{#if (is "eq" ../this.attacker.combat.specialPorpuseAttack.directed @key)}}selected{{/if}} value='{{@key}}'>{{localize (concat 'macros.combat.dialog.directedAttack.' @key '.title')}}</option>
    {{/if}}
  {{/each}}
{{/'systems/animabf/templates/common/ui/custom-select.hbs'}}
{{/if}}

{{#if (or (is 'eq' this.attacker.combat.specialPorpuseAttack.value 'takeDown') (is 'eq' this.attacker.combat.specialPorpuseAttack.value 'trapping'))}}
<div class='columns'>
  <div>
    {{>
      "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
      title=(localize 'macros.combat.dialog.specialPorpuseAttack.causeDamage.title')
      inputType="checkbox"
      inputName="attacker.combat.specialPorpuseAttack.causeDamage"
      inputValue=(is 'eq' this.attacker.combat.specialPorpuseAttack.causeDamage true)
    }}
  </div>
</div>
{{/if}}

{{#if this.attacker.combat.projectile.value}}
{{#if (is 'eq' this.attacker.distance.enable false)}}
<div class='columns'>
  <div>
    {{>
      "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
      title=(localize 'macros.combat.dialog.distance.title')
      inputType="checkbox"
      inputName="attacker.combat.distanceCheck"
      inputValue=(is 'eq' this.attacker.combat.distanceCheck true)
    }}
  </div>
</div>
{{/if}}
<div class='columns'>
  <div>
    {{>
      "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
      title=(localize 'macros.combat.dialog.highGround.title')
      inputType="checkbox"
      inputName="attacker.highGround"
      inputValue=(is 'eq' this.attacker.highGround true)
    }}
  </div>
</div>
<div class='columns'>
  <div>
    {{>
      "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
      title=(localize 'macros.combat.dialog.poorVisibility.title')
      inputType="checkbox"
      inputName="attacker.poorVisibility"
      inputValue=(is 'eq' this.attacker.poorVisibility true)
    }}
  </div>
</div>
<div class='columns'>
  <div>
    {{>
      "systems/animabf/templates/common/ui/horizontal-titled-input.hbs"
      title=(localize 'macros.combat.dialog.targetInCover.title')
      inputType="checkbox"
      inputName="attacker.targetInCover"
      inputValue=(is 'eq' this.attacker.targetInCover true)
    }}
  </div>
</div>
{{/if}}

{{#if this.attackSent}}
  <div class='attack-sent'>
    {{>'systems/animabf/templates/common/ui/loading-indicator.hbs' class="big"}}
    <p class='label'>
      {{localize 'macros.combat.dialog.attackSent.title'}}
    </p>
  </div>
{{else}}
  <button class='abf-button send-attack'>
    {{localize 'macros.combat.dialog.attackButton.title'}}
  </button>
{{/if}}
