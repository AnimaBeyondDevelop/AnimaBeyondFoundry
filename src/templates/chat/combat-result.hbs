{{#> "systems/animabf/templates/common/ui/group.hbs"
  class="animabf-chat-message combat-result-message"
  contractible=true
  contractibleItemId="chat-combat-result"
}}
  {{>
    "systems/animabf/templates/common/ui/group-header.hbs"
    title=(localize "chat.combatResult.title")
  }}

  {{#> "systems/animabf/templates/common/ui/group-body.hbs"}}
    <p data-requires-permission="gm"><strong>{{localize "chat.combatResult.difference"}}:</strong> {{combatResult.difference}}</p>

    {{#if combatResult.hasCounterAttack}}
      <p><strong>{{localize "chat.combatResult.counterAttackValue"}}:</strong> {{combatResult.counterAttackValue}}</p>
    {{/if}}

    <p><strong>{{localize "chat.combatResult.finalDamage"}}:</strong> {{combatResult.damageFinal}}</p>
    <p data-requires-permission="owner"><strong>{{localize "chat.combatResult.lifePercentRemoved"}}:</strong> {{combatResult.lifePercentRemoved}}%</p>
    <p data-requires-permission="owner"><strong>{{localize "chat.combatResult.isCritical"}}:</strong> {{#if combatResult.isCritical}}{{localize "chat.combatResult.yes"}}{{else}}{{localize "chat.combatResult.no"}}{{/if}}</p>

    {{#if combatResult.isCritical}}
      <p data-requires-permission="owner"><strong>{{localize "chat.combatResult.baseCriticalValue"}}:</strong> {{combatResult.baseCriticalValue}}</p>
    {{/if}}

    {{#if (gt combatResult.damageFinal 0)}}
      <div class="animabf-result-damage-controls"
           data-requires-permission="owner"
           style="margin-top:.5rem; display:flex; gap:.5rem; flex-wrap:wrap;">
        <button type="button"
                class="chat-action-button"
                style="flex:1 1 0; width:100%;"
                data-action="animabf-apply-damage"
                data-base="{{combatResult.damageFinal}}"
                data-mult="0.5"
                data-def-actor="{{defenderId}}"
                data-def-token="{{defenderTokenId}}">
          {{localize "chat.result.applyHalf"}}
        </button>

        <button type="button"
                class="chat-action-button"
                style="flex:1 1 0; width:100%;"
                data-action="animabf-apply-damage"
                data-base="{{combatResult.damageFinal}}"
                data-mult="1"
                data-def-actor="{{defenderId}}"
                data-def-token="{{defenderTokenId}}">
          {{localize "chat.result.applyFull"}}
        </button>

        <button type="button"
                class="chat-action-button"
                style="flex:1 1 0; width:100%;"
                data-action="animabf-apply-damage"
                data-base="{{combatResult.damageFinal}}"
                data-mult="2"
                data-def-actor="{{defenderId}}"
                data-def-token="{{defenderTokenId}}">
          {{localize "chat.result.applyDouble"}}
        </button>
      </div>
    {{/if}}
  {{/"systems/animabf/templates/common/ui/group-body.hbs"}}
{{/"systems/animabf/templates/common/ui/group.hbs"}}
